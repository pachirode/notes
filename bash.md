### Shell

查看当前设备默认的 `Shell`; `echo $SHELL`

查看当前设备安装的全部 `Shell`; `cat /etc/shells`

修改使用的 `Shell`;

- 找到需要修改的 `Shell` 的目标位置，`which fish`
- 修改默认 `Shell`, `chsh -s /usr/bin/fish`

### 命令

- `echo`
    - 屏幕输出一行文本

##### 命令格式

`Command [args]`

- 空格
    - 用来区分不同参数
- 分号
    - 命令的结束符
- 组合符号
    - `&&`
        - 运行成功继续运行下一个命令
    - `||`
        - 运行失败继续运行下一个命令
- 判断命令来源
    - `type`
      - 

### 参数

- `-n`
    - 取消末尾的回车符
- `-e`
    - 解析引号里面的特殊字符（`\n`）, 不使用则保持原样

### 模式扩展

接收到用户输入的命令之后，根据空格将用户的输入，拆分为一个个的词元，然后扩展词元中的特殊字符，扩展完成之后调用相应的命令
扩展可以看作原始的正则表达式

设置扩展

```bash
# 关闭扩展
set -o noglob
set -f

# 开启扩展
set +o noglob
set +f
```

- 波浪线 (`~`)
    - 当前用户的主目录
- `?`
    - 文件路径任意单个字符
- `*`
    - 文件路径任意个字符，包含零个
    - 不会匹配隐藏文件
    - 只匹配当前目录，不会匹配子目录
- `[...]`
    - 匹配括号中的任意字符
    - `[^...]` `[!...]` 匹配不在方括号内的字符
- `[start-end]`
    - 匹配一个连续范围
- `{...}`
    - 扩展括号里面的所有值
    - 不管文件是否存在，都会扩展
    - 逗号前后有空格，则扩展失效，会被认为是参数
    - 可以嵌套和其他格式联合
- `{start..end}`
    - 扩展成一个连续的序列，支持使用逆序列
    - 如果无法理解序列，则会原样输出
    - 整数前面有前导 `0`, 则扩展的每一项都有
    - `{start..end..step}`
- `$`
    - 变量扩展
- `$(...)`
    - 子命令扩展，扩展另一个命令运行的结果
- `$((...))`
    - 算数扩展，扩展整数运算的结果
- `[[:class:]]`
    - 字符类，扩展为某一类特定字符之一
        - `[[:alpha:]]`
            - 任意英文字母
        - `[[:blank:]]`
            - 空格和 `Tab`

> 大部分文件不存在则不发生扩展

通配符注意

- 先解释再执行
- 文件扩展名不在匹配时，会原样输出
- 只适用于单层路径
- 文件名可以使用通配符

##### `shopt`

可以调整 `bash` 的行为

- `dotglob`
    - 让扩展结果包含隐藏文件
- `nullglob`
    - 通配符不匹配任何文件名时，返回空字符串；默认保持不变
- `failglob`
    - 通配符不匹配任何文件名时，直接报错
- `extglob`
    - 是否支持 `ksh` 的一些扩展语法，主要为是否支持量词语法
- `nocaseglob`
    - 通配符扩展不支持大小写
- `golbstar`
    - `**` 匹配零个或者多个子目录

```bash
shopt -s [optionname] # 打开某个参数
shopt -u [optionname] # 关闭某个参数
shopt [optionname] # 查询某个参数关闭还是打开

shopt extglob # 查看功能是否开启
shopt -s extglob # 开启
```

##### 量词语法

用来控制匹配次数

- `?(pattern-list)`
    - 匹配零次或者一次
- `*(pattern-list)`
    - 匹配零次或者多次
- `+(pattern-list)`
    - 匹配一次或者多次
- `@(pattern-list)`
    - 只匹配一次
- `!(pattern-list)`
    - 匹配给定模式之外的内容

##### 案例

```bash
# 匹配隐藏文件
.*

# 匹配隐藏文件，同时排除 `.` `..` 两个特殊的隐藏文件
.[!.]*

# 创建一系列目录
mkdir {2007..2009}-{01..12}

ls a?(.)txt
```

### 引号和转义

##### 转义

某些字符在 `Bash` 里面有特殊含义，没有办法直接输出，使用 `\` 转义；如果想要命令行使用这些不可打印的字符，需要将他们放在引号里面

- `\`
    - 转义
    - 标识该行没结束
- `'`
    - 保留字符的字面含义，取消自动扩展
    - 里面无法使用转义，需要特殊处理 `$'\'`
- `"`
    - 大部分特殊字符失去含义
    - `$` ` `\` 除外
    - 保存原始命令的输出格式
    - 使用
        - 文件名包含空格
- `Here`
    - 输入多行字符串
    - 支持变量替换和反斜杠转义，但是不支持通配符扩展

```bash
# Here 文档语法
<< token
text
token

# Here 字符串
cat <<< string
echo string | cat
```

### 变量

- 环境变量
    - 显示所有环境变量
        - `env`
        - `printenv`
    - 大部分环境变量很少发生变化，是只读的
- 自定义变量
    - 用户在当前 `shell` 中自定义的变量，退出不存在
    - `set`
- 创建变量
    - 等号两边不能有空格
    - 如果变量的值包含空格，值需要放在引号里面
    - 同行定义多个变量必需使用 `;` 分隔
- 读取变量
    - `$var`
- 删除变量
    - `unset`
- 输出变量
    - `export`
- 特殊变量
    - 用户不能赋值
    - `$?`
        - 上一个命令的退出码
    - `$$`
        - 当前 `shell` 的进程 `ID`
    - `$_`
        - 上一个命令最后一个参数
    - `$!`
        - 最近一个后台执行异步命令的进程 `ID`
    - `$0`
        - 当前 `shell` 名字
    - `$-`
        - 当前 `shell` 的启动参数
    - `$@` `$#`
        - 脚本参数值和脚本参数数量
- 变量默认值
    - `${varname:-word}`
        - 变量存在且不为空，则返回它的值，否则返回 `word`
    - `${varname:=word}`
        - 变量存在且不为空，否则设置
    - `${varname:+word}`
        - 返回空
    - `${varname:?msg}`
        - 返回设置的报错信息
- `declare`
    - 声明一些特殊类型的变量 `declare OPTION VARIABLE=value`
        - `-a`
            - 数组变量
        - `-f`
            - 所有函数定义
        - `-F`
            - 所有函数名
        - `-i`
            - 整数变量
        - `-l`
            - 变量为小写字符
        - `-r`
            - 只读
        - `-x`
            - 环境变量
- `readonly`
    - 等价于 `delcare -r`
- `let`
    - 可以直接执行算术表达式

### 字符串

- 获取字符串长度
    - `${#var}`
- 提取字符串
    - `${#var:offset:length}`
- 搜索和替换
    - `${var#pattern}`
        - 字符串开头是否匹配给定的模式，成功匹配删除
    - `${var##pattern}`
        - 贪婪匹配
    - `${var%pattern}`
        - 从尾部开始
    - `${var/pattern/string}`
        - 任意位置开始
- 改变大小写
    - `${varname^^}`
        - 大写
    - `${varname,,}`

### 历史

文件保存在 `~/.bash_history`，可以使用 `echo $HISTFILE`
`history -c` 可以清除操作历史

- 定制 `history` 输出格式
    - `export HISTTIMEFORMAT='%F %T  '`
- 设置保存历史数量
    - `export HISTSIZE=10000`
- 设置某些命令不写入操作历史中
    - `export HISTIGNORE='pwd:ls:exit'`
- 启动某条命令
    - `!7`
    - `!-1` `!!`
- 输出上条命令
    - `!:p`
- 使用命令前增加一个确认步骤
    - `shopt -s histverify`

### 行操作

- 修改为快捷键
    - `set -o vi|emacs`

### 目录堆栈

方便用户在不同目录之间切换

- 返回上次的目录 `cd -` 只能记录一次
- 目录堆栈可以记忆多重目录
    - `pushd`
        - 类似 `cd` 命令，进入指定目录，并将其放入目录堆栈
    - `popd`
        - 进入目录，移除堆栈数据
        - `-n`
            - 仅操作堆栈，不改变目录
    - `dirs`
        - 显示目录堆栈的内容

### 脚本

- `shebang`
    - 脚本第一行，通常用来指定解释器
        - `#!/user/bin/env bash` 匹配环境变量中第一个匹配的
- 参数
    - `$1 ~ $9`
    - `shift`
        - 改变脚本参数，删除第一个参数，后面参数依次前移
    - `getopts optstring name`
        - 解析复杂脚本命令行参数，取出所有带有 `-` 的参数
    - 配置项终止符 `--`
        - 后面参数为实体参数
    - `exit`
    - `$?`
    - `source`
        - 执行一个脚本或者重新加载配置文件
    - `alias`
- `read [-options] [var...]`
    - 读取用户输入
    - 数量少为空，数量多合并到最后变量
    - `IFS` 修改默认分隔符
- 条件判断
    - `test`
        - 用来判断条件
            - `test expression`
            - `[ expression ]`
            - `[[ expression ]]`
                - 可以支持正则
    - `(())`
        - 算数判断
- 错误
  - `-x` 执行每一条命令之前打印
  - 环境变量
    - `LINENO`
      - 行号
    - `FUNCNAME`
      - 返回一个数组，当前函数调用的堆栈
    - `BASH_SOURCE`
      - 脚本调用的堆栈
- 临时文件夹
  - `mktemp`
    - 文件名为随机的，只给当前用户使用
  - `trap`
    - 响应系统信号
